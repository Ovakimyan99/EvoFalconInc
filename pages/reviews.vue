<template>
  <div>
    <div class="reviews-vk container">
      <div class="reviews-vk__text-wrapper">
        <p class="reviews-vk__text">—Å–æ –≤—Å–µ–º–∏ –æ—Ç–∑—ã–≤–∞–º–∏ –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –≤ –≥—Ä—É–ø–ø–µ –≤ –í–ö</p>
        <a href="https://vk.com/topic-200676580_47084795" target="_blank" class="reviews-vk__link">–ø–µ—Ä–µ–π—Ç–∏</a>
      </div>
      <img src="@/static/img/other/social/qr.jpg" alt="qr code evo falcon inc" class="reviews-vk__img-qr">
    </div>
    <app-sort-nav />
    <div ref="sliderWrapper">
      <div class="reviews-slider container" v-for="{ productName, anime, reviews, idd } of reviews" :data-idd="idd" :key="productName">
        <h2 class="reviews-slider__title">{{ productName }}</h2>
        <span class="reviews-slider__title" v-if="anime">anime: "{{ anime }}"</span>

        <div ref="reviewsWrapper" class="reviews-slider-wrapper">
          <section class="reviews-slide__sidebar">
            <div class="reviews-slide__content" v-for="review of [...reviews].reverse()" :key="review.name">
              <a v-if="review.userLink" :href="review.userLink" class="reviews-slide__name" target="_blank">{{ review.name }}</a>
              <span v-else class="reviews-slide__name">{{ review.name }}</span>
              <p class="reviews-slide__text">{{ review.text }}</p>
            </div>
          </section>

          <div class="reviews-slide__img-content">
            <picture class="reviews-slide__img-wrapper"  v-for="review of reviews" :key="review.name">
              <source v-if="review.img[0].indexOf('webp') > 0" :srcset="review.img[0]" class="reviews-slide__img">
              <source v-else-if="review.img[1] && review.img[1].indexOf('webp') > 0" :srcset="review.img[1]" class="reviews-slide__img">
              <img v-else :src="review.img[0]" class="reviews-slide__img" :alt="review.name">
            </picture>
          </div>

          <div class="reviews-slider__controls" data-active="0">
            <button class="controls__down-btn controls--btn" @click="(e) => changeSlide('down', e)">
              <i>&#8595;</i>
            </button>
            <button class="controls__up-btn controls--btn" @click="(e) => changeSlide('up', e)">
              <i>&#8593;</i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import AppSortNav from '@/components/SortNav'

export default {
  name: 'reviews',
  components: {
    AppSortNav
  },
  data: () => ({
    activeSlide: 0,
    reviews: [
      {
        productName: 'HOODIE ¬´EMPTINESS OF THE SOUL¬ª VOL.01',
        anime: 'Tokyo Ghoul',
        idd: '001',
        reviews: [
          {
            img: ['./img/lykbyk/hoody-kaneki/7.jpg'],
            name: '–ú–æ–∫–∞–ø',
            userLink: 'https://vk.com/iddizzycrow1947',
            text: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–≤–µ—Ä—Å–∞–π–∑ –∫—Ä–æ–π, —Å –Ω–∞—à–∏–≤–∫–∞–º–∏ –∏–∑ –¥–∂–∏–Ω—Å—ã –∏ –ø—Ä—è–º–æ–π –ø–æ–ª–Ω–æ—Ü–≤–µ—Ç–Ω–æ–π –ø–µ—á–∞—Ç—å—é.'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/2.jpg'],
            name: '–ü–æ–ª–∏–Ω–∞ –ú–∞–ª—ã—à–µ–≤–∞',
            userLink: 'https://vk.com/p.malysheva99',
            text: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å. –•—É–¥–∏ –µ–π –æ—á–µ–Ω—å –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/3.jpg'],
            name: '–î–∞–Ω–∏–ª–∞ –ë—É–ª–≥–∞–∫–æ–≤',
            userLink: 'https://vk.com/yrlywww',
            text: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å. –ï–º—É –æ—á–µ–Ω—å –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –∫–∞—á–µ—Å—Ç–≤–æ —Ö—É–¥–∏'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/4.jpg'],
            name: '–í—è—á–µ—Å–ª–∞–≤ –î—è–¥–∏—á–∫–æ',
            userLink: 'https://vk.com/dead_666x7',
            text: '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –Ω–∞—à–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –∫–æ–Ω–∫—É—Ä—Å–∞!'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/5.jpg'],
            name: '–î–∞–Ω—è –õ–µ–æ–Ω–µ–Ω–∫–æ',
            userLink: 'https://vk.com/trap_alligator',
            text: '–•–£–î–ê–ö –°–£–ü–ï–† –ö–õ–ê–°–°!!!!. –ó–ê–ö–ê–ó–´–í–ê–ô–¢–ï –û–ü–¢–û–ú –î–õ–Ø –í–°–ï–ô –°–ï–ú–¨–ò –ò –ñ–î–ò–¢–ï –õ–û–ù–ì. –ú–ê–¢–ï–†–ò–ê–õ –ò–ú–ë–ê. –ö–û–ì–î–ê –ù–ê–î–ï–í–ê–ï–®–¨ –ò–ì–†–ê–ï–¢ –ü–ï–°–ù–Ø –õ–ï–õ–ï–õ–ï–ú–ò–î–ê–ô. 1000-7?‚ò†.'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/8.jpg'],
            name: '–ö–∏—Ä–∏–ª–ª –ò–≤–∞–Ω–æ–≤',
            userLink: 'https://vk.com/plvgboi',
            text: '–•—É–¥–∏ –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, –≤—Å–µ–º —Å–æ–≤–µ—Ç—É—é —ç—Ç–æ—Ç –±—Ä–µ–Ω–¥. –†–µ–±—è—Ç–∞, –≤—ã –ª—É—á—à–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ)'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/9.jpg'],
            name: '–ù–∏–∫–∞ –î–æ–º–±—Ä–æ–≤—Å–∫–∞—è',
            userLink: 'https://vk.com/mbnikizzz',
            text: '–•–æ—á—É –ø–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π —Å–∏—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ —à–µ–¥–µ–≤—Ä–∞, —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ dead inside ü•µ\n' +
              '–ú–∞—Ç–µ—Ä–∏–∞–ª –æ—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω—ã–π, –∞ –ø—Ä–∏–Ω—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π üòç\n' +
              '–†–∞—Å–∫—É–ø–∞–π—Ç–µ, –ø–æ–∫–∞ –µ—Å—Ç—å –≤ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–µ, –Ω–µ –ø–æ–∂–∞–ª–µ–µ—Ç–µ)'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/10.jpg'],
            name: '–ê–Ω–¥—Ä–µ–π –ú–∞—Å–ª–æ–≤',
            userLink: 'https://vk.com/andy.msl666',
            text: '1000-7\n' + '–•—É–¥–∞–∫ —Ö–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ üî•'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/11.jpg'],
            name: '–¢–∏–≥—Ä–∞–Ω –û–≤–∞–∫–∏–º—è–Ω',
            userLink: 'https://vk.com/iddizzycrow1947',
            text: '–ó–Ω–∞–∫–æ–º—å—Ç–µ—Å—å, —ç—Ç–æ –∞–¥–º–∏–Ω :)'
          },
          {
            img: ['./img/lykbyk/hoody-kaneki/1.jpg'],
            name: '–§–æ—Ç–æ—Å–µ—Å—Å–∏—è',
            userLink: '',
            text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequuntur, tempore voluptatem.'
          }
        ]
      },
      {
        productName: 'CAREFULLY HOT',
        anime: '',
        idd: '002',
        reviews: [
          {
            img: ['./img/lykbyk/carefully-hot/carefullyHotFon.jpg'],
            name: '–ú–æ–∫–∞–ø',
            userLink: 'https://vk.com/evo_falcon_inc',
            text: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–≤–µ—Ä—Å–∞–π–∑ –∫—Ä–æ–π, —Å –Ω–∞—à–∏–≤–∫–∞–º–∏ –∏–∑ –¥–∂–∏–Ω—Å—ã –∏ –ø—Ä—è–º–æ–π –ø–æ–ª–Ω–æ—Ü–≤–µ—Ç–Ω–æ–π –ø–µ—á–∞—Ç—å—é.'
          },
          {
            img: ['./img/lykbyk/carefully-hot/1.jpg'],
            name: '–ê—Ä—Å–µ–Ω–∏–π –ò—â–µ–Ω–∫–æ',
            userLink: 'https://vk.com/sadboychristi',
            text: '–¢–∏—à–∫–∞ –ø—Ä–∏—à–ª–∞, –∫–∞—á–µ—Å—Ç–≤–æ–º —Ç–∫–∞–Ω–∏ –∏ –ø—Ä–∏–Ω—Ç–∞ –±–µ–∑—É–º–Ω–æ –¥–æ–≤–æ–ª–µ–Ω, —Å–∏–¥–∏—Ç –æ—Ç–ª–∏—á–Ω–æ, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–æ–Ω—É—Å–∞ –ø–æ–ª–æ–∂–∏–ª–∏ –∫–æ–Ω—Ñ–µ—Ç–∫–∏, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–æ–∑—å–º—É –µ—â—ë –∫–∞–∫—É—é –Ω–∏–±—É–¥—å –≤–µ—â—å!'
          },
          {
            img: ['./img/lykbyk/carefully-hot/2.jpg'],
            name: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å',
            userLink: 'https://vk.com/iddizzycrow1947',
            text: ''
          },
          {
            img: ['./img/lykbyk/carefully-hot/3.jpg'],
            name: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å',
            userLink: 'https://vk.com/dead_666x7',
            text: ''
          },
          {
            img: ['./img/lykbyk/carefully-hot/4.jpg'],
            name: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å',
            userLink: 'https://vk.com/iddizzycrow1947',
            text: ''
          },
          {
            img: ['./img/lykbyk/carefully-hot/5.jpg'],
            name: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å',
            userLink: 'https://vk.com/kamposter120',
            text: ''
          },
          {
            img: ['./img/lykbyk/carefully-hot/6.jpg'],
            name: '–§–æ—Ç–æ–º–æ–¥–µ–ª—å',
            userLink: 'https://vk.com/kamposter120',
            text: ''
          }
        ]
      }
    ]
  }),
  computed: {
    reviewsRevers () {
      return [...this.reviews].reverse()
    }
  },
  methods: {
    changeSlide (direction, e) {
      const sliderWrapper = e.target.closest('.reviews-slider-wrapper')
      const idd = e.target.closest('.reviews-slider').getAttribute('data-idd')
      const reviewLenght = this.reviews.find(item => item.idd === idd).reviews.length
      const reviewsControl = e.target.closest('.reviews-slider__controls')
      let activeSlide = reviewsControl.getAttribute('data-active')
      if (direction === 'up') {
        activeSlide++
        if (activeSlide === reviewLenght) {
          activeSlide = 0
        }
      } else if (direction === 'down') {
        activeSlide--
        if (activeSlide < 0) {
          activeSlide = reviewLenght - 1
        }
      }

      reviewsControl.setAttribute('data-active', activeSlide)
      const sidebar = sliderWrapper.querySelector('.reviews-slide__sidebar')
      const mainSlide = sliderWrapper.querySelector('.reviews-slide__img-content')

      const btnControls = sliderWrapper.querySelectorAll('.controls--btn')
      btnControls.forEach((item) => {
        const btnConrolsLeft = sidebar.clientWidth / sliderWrapper.clientWidth * 100
        item.style.left = `${btnConrolsLeft}%`
      })

      mainSlide.style.transform = `translateY(-${100 * activeSlide}%)`
      sidebar.style.transform = `translateY(${100 * (activeSlide - reviewLenght + 1)}%)`
    }
  },
  mounted () {
    const sliderWrapper = this.$refs.sliderWrapper
    const sliders = sliderWrapper.querySelectorAll('.reviews-slider')

    sliders.forEach((item) => {
      const sidebar = item.querySelector('.reviews-slide__sidebar')
      const heightOneSlide = sidebar.clientHeight / window.innerHeight * 100
      sidebar.style.transform = `translateY(-${(this.reviews.length - 1) * heightOneSlide}vh)`
    })
  }
}
</script>

<style scoped lang="scss">
.reviews-vk {
  display: flex;
  align-items: center;
  justify-content: center;
  max-height: 400px;
  margin: 50px auto;

  &__text {
    font-size: 20px;
    line-height: 1.3;
  }

  &__text-wrapper {
    color: #fff;
    text-transform: uppercase;
    text-align: center;
    max-width: 350px;
  }

  &__link {
    padding: 10px 20px;
    background: #5181B8;
    border-radius: 6px;
    color: #fff;
    font-size: 13px;
    margin: 10px auto 0;
    display: inline-block;
  }

  &__img-qr {
    width: 300px;
    margin-left: 60px;
  }
}

.reviews-slider {
  margin-top: 100px;

  &__title {
    display: block;
    font-size: 25px;
    text-align: center;
    color: #fff;
    text-transform: uppercase;
    line-height: 1.3;
  }
}

.reviews-slider-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  height: 450px;
  width: 80%;
  background-color: #1B212C;
  box-shadow: 0 0 30px -3px #1b212c;
  margin: 50px auto;
  border-radius: 7px;
  overflow: hidden;
}

.reviews-slide {

  &__sidebar {
    transition: transform 0.5s ease-in-out;
    height: 100%;
    left: 0;
    bottom: 0;
  }

  &__img-content {
    transition: transform 0.5s ease-in-out;
    height: 100%;
    right: 0;
    top: 0;
    max-width: 50%;
  }

  &__img-wrapper {
    height: 100%;
    position: relative;
    overflow: hidden;
    display: flex;
  }

  &__img {
    height: 100%;
    flex: auto;
    object-fit: cover;
  }

  &__content {
    height: 100%;
    text-align: left;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 20px 65px 20px 20px;
    color: #fff;
  }

  &__name {
    color: #fff;
    font-size: 13px;
    text-transform: uppercase;
    font-weight: 500;
    margin-bottom: 10px;
    display: inline;
    width: max-content;
  }

  &__text {
    font-size: 18px;
  }
}

.reviews-slider__controls {
}

.controls {

  &__down-btn {
    transform: translateX(-100%);
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
  }

  &__up-btn {
    transform: translateY(-100%);
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
  }

  &--btn {
    display: inline-block;
    background-color: #fff;
    border: none;
    color: #aaa;
    cursor: pointer;
    padding: 15px;
    font-size: 25px;
    line-height: 0.7;

    position: absolute;
    left: 50%;
    top: 50%;
    z-index: 100;

    &:hover {
      color: black;
    }
  }
}
</style>
